â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸ”§ FIX DEFINITIVO: SOBRESCRITURA DE DESCRIPCIONES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“… Fecha: 29 de diciembre de 2025
ğŸ¯ Problema: Las descripciones se sobrescriben entre sÃ­
âœ… Estado: SOLUCIONADO en Strapi

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
1. âŒ EL PROBLEMA IDENTIFICADO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

En el cÃ³digo de sincronizaciÃ³n de Strapi (woo-sync.ts), existÃ­an
"fallbacks cruzados" que causaban que ambas descripciones usaran
la misma fuente de datos:

CÃ“DIGO PROBLEMÃTICO:
--------------------
// Si description estÃ¡ vacÃ­a en rawWooData
product.description = descripcionTexto || libro.subtitulo_libro || '';

// Si short_description estÃ¡ vacÃ­a en rawWooData  
product.short_description = libro.subtitulo_libro || descripcionTexto || '';

RESULTADO:
- Si subtitulo_libro estaba vacÃ­o â†’ ambas descripciones usaban descripcionTexto
- Si descripcionTexto estaba vacÃ­o â†’ ambas descripciones usaban subtitulo_libro
- âŒ SE SOBRESCRIBÃAN MUTUAMENTE

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2. âœ… LA SOLUCIÃ“N IMPLEMENTADA EN STRAPI
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Ahora cada campo usa SOLO su fuente de datos correspondiente,
SIN fallbacks cruzados:

CÃ“DIGO CORREGIDO:
-----------------
// Description usa SOLO libro.descripcion (campo blocks)
product.description = descripcionTexto || '';

// Short description usa SOLO libro.subtitulo_libro (campo texto)
product.short_description = libro.subtitulo_libro || '';

MAPEO CORRECTO:
---------------
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STRAPI                    â†’    WOOCOMMERCE              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ libro.descripcion         â†’    description              â”‚
â”‚ (tipo: blocks)                 (HTML/texto largo)       â”‚
â”‚                                                          â”‚
â”‚ libro.subtitulo_libro     â†’    short_description        â”‚
â”‚ (tipo: string)                 (texto corto, max 255)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
3. ğŸ“‹ QUÃ‰ DEBE HACER LA INTRANET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ESTRUCTURA CORRECTA DEL PAYLOAD:
--------------------------------

const payload = {
  data: {
    nombre_libro: "...",
    isbn_libro: "...",
    // ... otros campos de Strapi ...
    
    // âš ï¸ IMPORTANTE: rawWooData debe tener DOS campos distintos
    rawWooData: {
      description: "DescripciÃ³n larga del producto...",
      short_description: "DescripciÃ³n corta del producto...",
      // ... otros campos de WooCommerce ...
    }
  }
};

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
4. âœ… CHECKLIST PARA LA INTRANET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–¡ 1. Tener DOS inputs separados en el formulario:
     - Input "DescripciÃ³n del producto" (textarea grande)
     - Input "DescripciÃ³n corta" (input texto, max 255 caracteres)

â–¡ 2. Mapear correctamente en el payload:
     rawWooData.description = valorDelTextareaLargo
     rawWooData.short_description = valorDelInputCorto

â–¡ 3. NUNCA igualar ambos valores:
     âŒ MAL:
     rawWooData.description = descripcion
     rawWooData.short_description = descripcion  // Â¡Duplicado!
     
     âœ… BIEN:
     rawWooData.description = descripcionLarga
     rawWooData.short_description = descripcionCorta  // Â¡Diferente!

â–¡ 4. Permitir que uno estÃ© vacÃ­o:
     âœ… OK: description tiene texto, short_description vacÃ­a
     âœ… OK: short_description tiene texto, description vacÃ­a
     âœ… OK: ambas vacÃ­as (Strapi usarÃ¡ campos propios)

â–¡ 5. Validar longitud de short_description:
     - MÃ¡ximo recomendado: 160 caracteres
     - MÃ¡ximo permitido: 255 caracteres

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
5. ğŸ§ª CÃ“MO PROBAR QUE FUNCIONA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PRUEBA 1: Crear producto con ambas descripciones diferentes
------------------------------------------------------------
Payload:
{
  data: {
    nombre_libro: "Libro de Prueba",
    isbn_libro: "9781234567890",
    rawWooData: {
      description: "Esta es la descripciÃ³n larga del libro con todos los detalles.",
      short_description: "DescripciÃ³n corta"
    }
  }
}

Esperado en WooCommerce:
- Description: "Esta es la descripciÃ³n larga del libro con todos los detalles."
- Short Description: "DescripciÃ³n corta"


PRUEBA 2: Crear producto solo con description
----------------------------------------------
Payload:
{
  data: {
    nombre_libro: "Libro de Prueba 2",
    isbn_libro: "9781234567891",
    rawWooData: {
      description: "Solo descripciÃ³n larga",
      short_description: ""
    }
  }
}

Esperado en WooCommerce:
- Description: "Solo descripciÃ³n larga"
- Short Description: "" (vacÃ­a)


PRUEBA 3: Crear producto solo con short_description
----------------------------------------------------
Payload:
{
  data: {
    nombre_libro: "Libro de Prueba 3",
    isbn_libro: "9781234567892",
    rawWooData: {
      description: "",
      short_description: "Solo descripciÃ³n corta"
    }
  }
}

Esperado en WooCommerce:
- Description: "" (vacÃ­a)
- Short Description: "Solo descripciÃ³n corta"


PRUEBA 4: Editar producto cambiando solo la description
--------------------------------------------------------
Payload (PUT):
{
  data: {
    rawWooData: {
      description: "Nueva descripciÃ³n larga editada",
      short_description: "DescripciÃ³n corta original (sin cambios)"
    }
  }
}

Esperado en WooCommerce:
- Description: "Nueva descripciÃ³n larga editada" (actualizada)
- Short Description: "DescripciÃ³n corta original (sin cambios)" (sin cambios)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
6. ğŸ“Š DIAGNÃ“STICO: Â¿POR QUÃ‰ SEGUÃA FALLANDO ANTES?
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PROBLEMA 1: Intranet no enviaba rawWooData
-------------------------------------------
Si la Intranet no incluÃ­a rawWooData en el payload, Strapi usaba
los fallbacks cruzados que causaban la sobrescritura.

SOLUCIÃ“N: Siempre enviar rawWooData con ambos campos.


PROBLEMA 2: Intranet enviaba ambas descripciones iguales
---------------------------------------------------------
Ejemplo:
const descripcion = formData.get('descripcion');
rawWooData.description = descripcion;
rawWooData.short_description = descripcion; // âŒ Duplicado

SOLUCIÃ“N: Tener dos inputs separados y mapearlos correctamente.


PROBLEMA 3: Strapi completaba campos vacÃ­os con fallbacks
----------------------------------------------------------
Si rawWooData.short_description venÃ­a vacÃ­a, Strapi la llenaba
con descripcionTexto (del campo description).

SOLUCIÃ“N: âœ… Ya corregido en este fix. Ahora Strapi NO hace
fallbacks cruzados.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
7. ğŸ¯ RESUMEN EJECUTIVO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ANTES (âŒ):
-----------
- Strapi tenÃ­a fallbacks cruzados
- Si un campo estaba vacÃ­o, usaba el otro
- Resultado: descripciones duplicadas

AHORA (âœ…):
-----------
- Strapi usa campos independientes sin fallbacks
- description â† SOLO libro.descripcion
- short_description â† SOLO libro.subtitulo_libro
- Si rawWooData viene con valores, los respeta tal cual

ACCIÃ“N REQUERIDA INTRANET:
---------------------------
1. Verificar que se envÃ­en DOS campos distintos en rawWooData
2. NO igualar ambos valores
3. Permitir que estÃ©n vacÃ­os si no hay contenido

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
8. ğŸ“ PROMPT PARA CURSOR (INTRANET)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PROMPT COMPLETO:
----------------

```
# FIX: Descripciones sobrescritas en productos

## Problema
Al crear/editar productos, la "DescripciÃ³n del producto" y la 
"DescripciÃ³n corta" se estÃ¡n sobrescribiendo con el mismo contenido.

## Causa raÃ­z
Strapi tenÃ­a fallbacks cruzados que ya fueron corregidos. Ahora 
debemos asegurarnos de que la Intranet envÃ­e correctamente DOS 
valores distintos en rawWooData.

## SoluciÃ³n a implementar

### 1. Verificar que existan DOS inputs separados:
- Un textarea para "DescripciÃ³n del producto" (largo)
- Un input text para "DescripciÃ³n corta" (max 160-255 caracteres)

### 2. Al construir el payload, mapear correctamente:

```typescript
const payload = {
  data: {
    nombre_libro: formData.get('nombre'),
    isbn_libro: formData.get('isbn'),
    rawWooData: {
      // DescripciÃ³n larga (del textarea)
      description: formData.get('descripcionLarga') || '',
      
      // DescripciÃ³n corta (del input separado)
      short_description: formData.get('descripcionCorta') || '',
      
      // ... otros campos ...
    }
  }
};
```

### 3. NUNCA hacer esto:

```typescript
// âŒ MAL - Duplica el mismo valor
const descripcion = formData.get('descripcion');
rawWooData.description = descripcion;
rawWooData.short_description = descripcion; // Â¡Error!
```

### 4. âœ… CORRECTO:

```typescript
// âœ… BIEN - Valores independientes
rawWooData.description = formData.get('descripcionLarga');
rawWooData.short_description = formData.get('descripcionCorta');
```

### 5. Validaciones recomendadas:
- short_description: mÃ¡ximo 160 caracteres (SEO)
- Permitir que cualquiera estÃ© vacÃ­o
- Mostrar preview de cÃ³mo se verÃ¡ en WooCommerce

## Testing
DespuÃ©s de implementar, probar:
1. Crear producto con ambas descripciones diferentes
2. Editar solo la descripciÃ³n larga
3. Editar solo la descripciÃ³n corta
4. Verificar en WooCommerce que no se sobrescriban
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… FIN DEL DOCUMENTO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

