â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”§ FIX CRÃTICO: Enviar rawWooData a Strapi
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PROBLEMA IDENTIFICADO:
Ya estÃ¡s construyendo rawWooData correctamente con las descripciones,
pero NO lo estÃ¡s enviando en el payload a Strapi.

CAUSA:
En tu cÃ³digo actual:
- âœ… CONSTRUYES rawWooData con description y short_description
- âŒ NO ENVÃAS rawWooData en el payload a Strapi

RESULTADO:
Las descripciones quedan vacÃ­as en WooCommerce porque Strapi no recibe
la informaciÃ³n en rawWooData.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SOLUCIÃ“N: Incluir rawWooData en el payload
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ANTES (ACTUAL - INCORRECTO):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const rawWooData = {
  description: formData.descripcion?.trim()
    ? textoAHTML(formData.descripcion)
    : '<p>Sin descripciÃ³n</p>',
  
  short_description: formData.descripcion_corta?.trim()
    ? textoAHTML(formData.descripcion_corta)
    : (formData.descripcion?.trim()
        ? generarDescripcionCorta(formData.descripcion, 150)
        : '<p>Sin descripciÃ³n</p>'),
  
  // ... otros campos de WooCommerce
};

// Payload a Strapi
const payload = {
  data: {
    descripcion: formData.descripcion?.trim() || '',
    subtitulo_libro: formData.descripcion_corta?.trim() || 
                     formData.descripcion?.substring(0, 255) || '',
    nombre_libro: formData.nombre,
    precio: formData.precio,
    // âŒ rawWooData NO SE ENVÃA
  }
};

DESPUÃ‰S (CORRECTO):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const rawWooData = {
  name: formData.nombre,
  type: 'simple',
  status: 'publish',
  sku: formData.isbn,
  
  // âœ… Descripciones
  description: formData.descripcion?.trim()
    ? textoAHTML(formData.descripcion)
    : '<p>Sin descripciÃ³n</p>',
  
  short_description: formData.descripcion_corta?.trim()
    ? textoAHTML(formData.descripcion_corta)
    : (formData.descripcion?.trim()
        ? generarDescripcionCorta(formData.descripcion, 150)
        : '<p>Sin descripciÃ³n</p>'),
  
  // Precio
  regular_price: formData.precio?.toString() || '0',
  sale_price: formData.precio_oferta?.toString() || '',
  
  // Stock
  manage_stock: true,
  stock_quantity: parseInt(formData.stock) || 0,
  stock_status: parseInt(formData.stock) > 0 ? 'instock' : 'outofstock',
  backorders: 'no',
  backorders_allowed: false,
  
  // Dimensiones
  weight: formData.peso?.toString() || '',
  dimensions: {
    length: formData.largo?.toString() || '',
    width: formData.ancho?.toString() || '',
    height: formData.alto?.toString() || ''
  },
  
  shipping_class: formData.clase_envio || '',
  
  // ImÃ¡genes (si tienes)
  images: formData.imagenUrl ? [
    {
      src: formData.imagenUrl,
      name: formData.nombre,
      alt: formData.nombre
    }
  ] : []
};

// Payload a Strapi
const payload = {
  data: {
    // Campos de Strapi
    nombre_libro: formData.nombre,
    isbn_libro: formData.isbn,
    precio: parseFloat(formData.precio) || 0,
    precio_oferta: formData.precio_oferta ? parseFloat(formData.precio_oferta) : null,
    stock_quantity: parseInt(formData.stock) || 0,
    estado_publicacion: 'Publicado',
    canales: [1, 2], // 1 = moraleja, 2 = escolar
    
    // Descripciones en campos de Strapi
    descripcion: formData.descripcion?.trim() || '',
    subtitulo_libro: formData.descripcion_corta?.trim() || 
                     formData.descripcion?.substring(0, 255) || '',
    
    // âœ… AGREGAR rawWooData
    rawWooData: rawWooData,
  }
};

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CÃ“DIGO COMPLETO PARA CREAR/EDITAR PRODUCTO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const handleSubmit = async (formData, modoEdicion = false, productoId = null) => {
  try {
    // 1. Construir rawWooData (ya lo haces)
    const rawWooData = {
      name: formData.nombre,
      type: 'simple',
      status: 'publish',
      sku: formData.isbn,
      
      // Descripciones (tu lÃ³gica actual - estÃ¡ correcta)
      description: formData.descripcion?.trim()
        ? textoAHTML(formData.descripcion)
        : '<p>Sin descripciÃ³n</p>',
      
      short_description: formData.descripcion_corta?.trim()
        ? textoAHTML(formData.descripcion_corta)
        : (formData.descripcion?.trim()
            ? generarDescripcionCorta(formData.descripcion, 150)
            : '<p>Sin descripciÃ³n</p>'),
      
      // Precio
      regular_price: formData.precio?.toString() || '0',
      sale_price: formData.precio_oferta?.toString() || '',
      
      // Stock
      manage_stock: true,
      stock_quantity: parseInt(formData.stock) || 0,
      stock_status: parseInt(formData.stock) > 0 ? 'instock' : 'outofstock',
      backorders: 'no',
      backorders_allowed: false,
      
      // Dimensiones
      weight: formData.peso?.toString() || '',
      dimensions: {
        length: formData.largo?.toString() || '',
        width: formData.ancho?.toString() || '',
        height: formData.alto?.toString() || ''
      },
      
      shipping_class: formData.clase_envio || '',
    };
    
    // 2. Construir payload a Strapi
    const payload = {
      data: {
        // Campos de Strapi
        nombre_libro: formData.nombre,
        isbn_libro: formData.isbn,
        precio: parseFloat(formData.precio) || 0,
        precio_oferta: formData.precio_oferta ? parseFloat(formData.precio_oferta) : null,
        stock_quantity: parseInt(formData.stock) || 0,
        manage_stock: true,
        stock_status: parseInt(formData.stock) > 0 ? 'instock' : 'outofstock',
        estado_publicacion: 'Publicado',
        canales: [1, 2],
        
        // Descripciones para Strapi
        descripcion: formData.descripcion?.trim() || '',
        subtitulo_libro: formData.descripcion_corta?.trim() || 
                         formData.descripcion?.substring(0, 255) || '',
        
        // Dimensiones para Strapi
        weight: formData.peso ? parseFloat(formData.peso) : null,
        length: formData.largo ? parseFloat(formData.largo) : null,
        width: formData.ancho ? parseFloat(formData.ancho) : null,
        height: formData.alto ? parseFloat(formData.alto) : null,
        
        // âœ… CRÃTICO: Incluir rawWooData
        rawWooData: rawWooData,
      }
    };
    
    // 3. Debug (verificar antes de enviar)
    console.log('ğŸ“¦ Payload a Strapi:', JSON.stringify(payload, null, 2));
    console.log('ğŸ” VerificaciÃ³n rawWooData:', {
      tieneRawWooData: !!payload.data.rawWooData,
      tieneDescription: !!payload.data.rawWooData?.description,
      tieneShortDescription: !!payload.data.rawWooData?.short_description,
      longitudDescription: payload.data.rawWooData?.description?.length,
      longitudShortDescription: payload.data.rawWooData?.short_description?.length,
    });
    
    // 4. Enviar a Strapi
    const endpoint = modoEdicion
      ? `https://strapi.moraleja.cl/api/libros/${productoId}`
      : 'https://strapi.moraleja.cl/api/libros';
    
    const response = await fetch(endpoint, {
      method: modoEdicion ? 'PUT' : 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(payload)
    });
    
    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(errorData.error?.message || 'Error al guardar producto');
    }
    
    const resultado = await response.json();
    console.log('âœ… Producto guardado exitosamente:', resultado);
    
    return resultado;
    
  } catch (error) {
    console.error('âŒ Error al guardar producto:', error);
    throw error;
  }
};

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
VERIFICAR QUE FUNCIONA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. VER EN CONSOLA ANTES DE ENVIAR:
   Debe mostrar:
   âœ… tieneRawWooData: true
   âœ… tieneDescription: true
   âœ… tieneShortDescription: true
   âœ… longitudDescription: 200+ caracteres
   âœ… longitudShortDescription: ~150 caracteres

2. VERIFICAR PAYLOAD COMPLETO:
   console.log('Payload:', JSON.stringify(payload, null, 2));
   
   Debe incluir:
   {
     "data": {
       "nombre_libro": "...",
       "descripcion": "...",
       "subtitulo_libro": "...",
       "rawWooData": {
         "description": "<p>...</p>",
         "short_description": "<p>...</p>"
       }
     }
   }

3. DESPUÃ‰S DE CREAR, VERIFICAR EN WOOCOMMERCE:
   - Ir a WooCommerce Admin
   - Buscar el producto reciÃ©n creado
   - Tab "DescripciÃ³n" â†’ Debe tener contenido
   - Tab "DescripciÃ³n corta" â†’ Debe tener contenido

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RESUMEN DEL CAMBIO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CAMBIO NECESARIO:
Solo agregar UNA lÃ­nea al payload:

const payload = {
  data: {
    nombre_libro: formData.nombre,
    descripcion: formData.descripcion,
    subtitulo_libro: formData.descripcion_corta,
    // ... otros campos
    
    rawWooData: rawWooData,  // âœ… AGREGAR ESTA LÃNEA
  }
};

RESULTADO:
âœ… Strapi recibe rawWooData con las descripciones
âœ… Strapi sincroniza a WooCommerce con las descripciones
âœ… Descripciones aparecen en WooCommerce
âœ… DescripciÃ³n completa y corta son diferentes

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
IMPORTANTE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Ya estÃ¡s construyendo rawWooData correctamente âœ…
2. Ya estÃ¡s procesando las descripciones correctamente âœ…
3. Solo falta ENVIAR rawWooData en el payload a Strapi âŒ

SOLUCIÃ“N: Agregar 1 lÃ­nea â†’ rawWooData: rawWooData,

TIEMPO: 2 minutos de implementaciÃ³n

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

AGREGA rawWooData AL PAYLOAD Y LAS DESCRIPCIONES APARECERÃN
CORRECTAMENTE EN WOOCOMMERCE.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

