â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”§ FIX: DescripciÃ³n Corta muestra el MISMO texto que DescripciÃ³n
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PROBLEMA ACTUAL:
âœ… DescripciÃ³n del producto â†’ Se llena correctamente
âŒ DescripciÃ³n corta â†’ Muestra TODO el texto completo (igual que descripciÃ³n)

CAUSA:
EstÃ¡s enviando el MISMO texto para ambos campos:

rawWooData: {
  description: formData.descripcion,        // Texto completo
  short_description: formData.descripcion   // âŒ MISMO texto completo
}

RESULTADO:
Ambos campos tienen el mismo contenido largo en WooCommerce.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SOLUCIÃ“N: Acortar la descripciÃ³n corta
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

DESCRIPCIÃ“N COMPLETA:
- Texto completo sin lÃ­mite
- Formato HTML con pÃ¡rrafos

DESCRIPCIÃ“N CORTA:
- MÃ¡ximo 150-200 caracteres
- Solo texto resumido
- Formato HTML simple

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FUNCIONES HELPER CORREGIDAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 1. Convierte texto plano a HTML (para description)
function textoAHTML(texto) {
  if (!texto) return '';
  
  // Convertir saltos de lÃ­nea dobles en pÃ¡rrafos
  const parrafos = texto.split('\n\n')
    .filter(p => p.trim())
    .map(p => `<p>${p.trim().replace(/\n/g, '<br>')}</p>`)
    .join('');
  
  return parrafos || `<p>${texto}</p>`;
}

// 2. Genera descripciÃ³n CORTA limitada (para short_description)
function generarDescripcionCorta(texto, maxCaracteres = 150) {
  if (!texto) return '';
  
  // Limpiar saltos de lÃ­nea y convertir a una sola lÃ­nea
  const textoLimpio = texto.replace(/\n/g, ' ').trim();
  
  // Limitar a X caracteres
  let textoCorto;
  if (textoLimpio.length > maxCaracteres) {
    // Cortar en la Ãºltima palabra completa antes del lÃ­mite
    textoCorto = textoLimpio.substring(0, maxCaracteres);
    const ultimoEspacio = textoCorto.lastIndexOf(' ');
    if (ultimoEspacio > 0) {
      textoCorto = textoCorto.substring(0, ultimoEspacio);
    }
    textoCorto += '...';
  } else {
    textoCorto = textoLimpio;
  }
  
  return `<p>${textoCorto}</p>`;
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
USO CORRECTO EN EL PAYLOAD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ANTES (INCORRECTO):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const payload = {
  data: {
    rawWooData: {
      description: formData.descripcion,       // âŒ Texto plano
      short_description: formData.descripcion  // âŒ MISMO texto completo
    }
  }
};

DESPUÃ‰S (CORRECTO):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const payload = {
  data: {
    rawWooData: {
      // âœ… DescripciÃ³n completa en HTML
      description: textoAHTML(formData.descripcion),
      
      // âœ… DescripciÃ³n corta LIMITADA a 150 caracteres
      short_description: generarDescripcionCorta(formData.descripcion, 150)
    }
  }
};

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EJEMPLO COMPLETO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Supongamos que formData.descripcion tiene:
const descripcionLarga = `CÃ¡lculo I es un libro fundamental para estudiantes de ingenierÃ­a y ciencias.

Incluye mÃ¡s de 500 ejercicios resueltos paso a paso, con explicaciones detalladas de cada concepto matemÃ¡tico.

Los temas cubiertos incluyen lÃ­mites, derivadas, integrales y sus aplicaciones prÃ¡cticas en problemas de ingenierÃ­a.`;

// Al procesar:

// description (completa con HTML):
const description = textoAHTML(descripcionLarga);
// Resultado: 
// "<p>CÃ¡lculo I es un libro fundamental para estudiantes de ingenierÃ­a y ciencias.</p>
//  <p>Incluye mÃ¡s de 500 ejercicios resueltos paso a paso, con explicaciones detalladas de cada concepto matemÃ¡tico.</p>
//  <p>Los temas cubiertos incluyen lÃ­mites, derivadas, integrales y sus aplicaciones prÃ¡cticas en problemas de ingenierÃ­a.</p>"

// short_description (solo primeras 150 caracteres):
const shortDescription = generarDescripcionCorta(descripcionLarga, 150);
// Resultado:
// "<p>CÃ¡lculo I es un libro fundamental para estudiantes de ingenierÃ­a y ciencias. Incluye mÃ¡s de 500 ejercicios resueltos paso a paso, con...</p>"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
IMPLEMENTACIÃ“N COMPLETA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 1. Agregar funciones helper al inicio del archivo
function textoAHTML(texto) {
  if (!texto) return '';
  const parrafos = texto.split('\n\n')
    .filter(p => p.trim())
    .map(p => `<p>${p.trim().replace(/\n/g, '<br>')}</p>`)
    .join('');
  return parrafos || `<p>${texto}</p>`;
}

function generarDescripcionCorta(texto, maxCaracteres = 150) {
  if (!texto) return '';
  const textoLimpio = texto.replace(/\n/g, ' ').trim();
  let textoCorto;
  if (textoLimpio.length > maxCaracteres) {
    textoCorto = textoLimpio.substring(0, maxCaracteres);
    const ultimoEspacio = textoCorto.lastIndexOf(' ');
    if (ultimoEspacio > 0) {
      textoCorto = textoCorto.substring(0, ultimoEspacio);
    }
    textoCorto += '...';
  } else {
    textoCorto = textoLimpio;
  }
  return `<p>${textoCorto}</p>`;
}

// 2. En tu funciÃ³n de crear/actualizar producto
const handleSubmit = async (formData) => {
  try {
    // âœ… Procesar descripciones correctamente
    const descripcionCompleta = textoAHTML(formData.descripcion);
    const descripcionCorta = generarDescripcionCorta(formData.descripcion, 150);
    
    // Verificar en consola (para debugging)
    console.log('DescripciÃ³n completa:', descripcionCompleta);
    console.log('DescripciÃ³n corta:', descripcionCorta);
    
    const payload = {
      data: {
        nombre_libro: formData.nombre,
        isbn_libro: formData.isbn,
        precio: parseFloat(formData.precio),
        stock_quantity: parseInt(formData.stock) || 0,
        estado_publicacion: "Publicado",
        canales: [1, 2],
        
        rawWooData: {
          name: formData.nombre,
          type: "simple",
          status: "publish",
          sku: formData.isbn,
          
          // âœ… Descripciones DIFERENTES
          description: descripcionCompleta,      // HTML completo
          short_description: descripcionCorta,   // Solo 150 caracteres
          
          regular_price: formData.precio.toString(),
          manage_stock: true,
          stock_quantity: parseInt(formData.stock) || 0,
          stock_status: parseInt(formData.stock) > 0 ? 'instock' : 'outofstock',
          backorders: 'no'
        }
      }
    };
    
    const response = await fetch(
      'https://strapi.moraleja.cl/api/libros',
      {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      }
    );
    
    if (!response.ok) {
      throw new Error('Error al guardar producto');
    }
    
    console.log('âœ… Producto guardado con descripciones diferentes');
    
  } catch (error) {
    console.error('âŒ Error:', error);
  }
};

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
VERIFICAR QUE FUNCIONA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. ANTES DE ENVIAR - Ver en consola:
   console.log('Description length:', descripcionCompleta.length);
   console.log('Short description length:', descripcionCorta.length);
   
   DEBE MOSTRAR:
   Description length: 500+ caracteres (o mÃ¡s)
   Short description length: ~150-180 caracteres

2. DESPUÃ‰S DE CREAR - Ver en WooCommerce Admin:
   - Tab "DescripciÃ³n" â†’ Texto completo con mÃºltiples pÃ¡rrafos
   - Tab "DescripciÃ³n corta" â†’ Solo las primeras lÃ­neas (~150 caracteres)

3. VER EN EL FRONTEND:
   - PÃ¡gina del producto â†’ DescripciÃ³n completa en tab "DescripciÃ³n"
   - PÃ¡gina de listado â†’ Solo descripciÃ³n corta

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
AJUSTAR LONGITUD DE DESCRIPCIÃ“N CORTA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Puedes cambiar el lÃ­mite de caracteres segÃºn tus necesidades:

// MÃ¡s corta (100 caracteres)
short_description: generarDescripcionCorta(formData.descripcion, 100)

// Normal (150 caracteres) - RECOMENDADO
short_description: generarDescripcionCorta(formData.descripcion, 150)

// MÃ¡s larga (200 caracteres)
short_description: generarDescripcionCorta(formData.descripcion, 200)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CASO ESPECIAL: Si tienes campo separado para descripciÃ³n corta
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Si en tu formulario tienes DOS campos de texto:
- formData.descripcion (descripciÃ³n completa)
- formData.descripcionCorta (descripciÃ³n corta especÃ­fica)

Entonces usa:

rawWooData: {
  // DescripciÃ³n completa
  description: textoAHTML(formData.descripcion),
  
  // DescripciÃ³n corta desde campo especÃ­fico
  short_description: formData.descripcionCorta 
    ? textoAHTML(formData.descripcionCorta)
    : generarDescripcionCorta(formData.descripcion, 150)
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
DEBUGGING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Si despuÃ©s de implementar SIGUE mostrando el mismo texto:

1. Verificar que las funciones helper estÃ¡n definidas:
   console.log(typeof textoAHTML); // Debe mostrar: "function"
   console.log(typeof generarDescripcionCorta); // Debe mostrar: "function"

2. Verificar que se estÃ¡n llamando correctamente:
   console.log('Description:', descripcionCompleta);
   console.log('Short description:', descripcionCorta);
   
3. Verificar que son DIFERENTES:
   console.log('Â¿Son diferentes?', descripcionCompleta !== descripcionCorta);
   // Debe mostrar: true

4. Ver el payload completo antes de enviar:
   console.log('Payload:', JSON.stringify(payload, null, 2));

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RESUMEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PROBLEMA:
description y short_description tienen el MISMO texto completo

CAUSA:
rawWooData: {
  description: formData.descripcion,       // Texto completo
  short_description: formData.descripcion  // MISMO texto completo
}

SOLUCIÃ“N:
rawWooData: {
  description: textoAHTML(formData.descripcion),              // HTML completo
  short_description: generarDescripcionCorta(formData.descripcion, 150)  // Solo 150 chars
}

RESULTADO:
âœ… Description: Texto completo con formato
âœ… Short description: Solo primeras 150 caracteres

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

IMPLEMENTA LAS FUNCIONES HELPER Y USA generarDescripcionCorta()
PARA LIMITAR LA DESCRIPCIÃ“N CORTA A 150 CARACTERES.

DESPUÃ‰S DE IMPLEMENTAR, LAS DESCRIPCIONES SERÃN DIFERENTES.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

