â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”§ SOLUCIÃ“N: Dos Campos SEPARADOS para Descripciones
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SITUACIÃ“N ACTUAL:
Tienes DOS campos en el formulario de Intranet:
1. ğŸ“ "DescripciÃ³n del producto" (texto largo)
2. ğŸ“ "DescripciÃ³n corta" (texto breve)

PROBLEMA:
Ambos campos se sobrescriben y muestran lo mismo en WooCommerce

CAUSA:
EstÃ¡s usando la misma variable (formData.descripcion) para ambos campos

SOLUCIÃ“N:
Usar variables DIFERENTES para cada campo

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PASO 1: VERIFICAR QUE TENGAS DOS CAMPOS EN EL FORMULARIO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Tu formulario debe tener DOS textareas/inputs separados:

<form>
  {/* Campo 1: DescripciÃ³n completa */}
  <label>DescripciÃ³n del producto</label>
  <textarea
    value={formData.descripcion}
    onChange={(e) => setFormData({...formData, descripcion: e.target.value})}
    rows={10}
    placeholder="DescripciÃ³n completa del producto"
  />
  
  {/* Campo 2: DescripciÃ³n corta */}
  <label>DescripciÃ³n corta</label>
  <textarea
    value={formData.descripcionCorta}
    onChange={(e) => setFormData({...formData, descripcionCorta: e.target.value})}
    rows={3}
    placeholder="Resumen breve (150 caracteres)"
    maxLength={200}
  />
  
  {/* Otros campos... */}
</form>

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PASO 2: INICIALIZAR EL ESTADO CON DOS CAMPOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const [formData, setFormData] = useState({
  nombre: '',
  isbn: '',
  precio: '',
  stock: 0,
  descripcion: '',          // âœ… Campo 1: DescripciÃ³n completa
  descripcionCorta: '',     // âœ… Campo 2: DescripciÃ³n corta
  peso: '',
  largo: '',
  ancho: '',
  alto: ''
});

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PASO 3: USAR AMBOS CAMPOS EN EL PAYLOAD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

En tu funciÃ³n handleSubmit:

const handleSubmit = async (formData) => {
  try {
    // âœ… Procesar AMBOS campos por separado
    
    // DescripciÃ³n completa desde el campo grande
    const descripcionCompletaHTML = textoAHTML(formData.descripcion);
    
    // DescripciÃ³n corta desde su propio campo
    // Si el usuario escribiÃ³ en el campo corto, usar ese
    // Si no, auto-generar desde la descripciÃ³n completa
    const descripcionCortaHTML = formData.descripcionCorta 
      ? textoAHTML(formData.descripcionCorta)  // âœ… Usar campo especÃ­fico
      : generarDescripcionCorta(formData.descripcion, 150);  // Fallback
    
    // Debug
    console.log('ğŸ“ DescripciÃ³n completa:', descripcionCompletaHTML);
    console.log('ğŸ“ DescripciÃ³n corta:', descripcionCortaHTML);
    console.log('ğŸ“ Â¿Son diferentes?', descripcionCompletaHTML !== descripcionCortaHTML);
    
    const payload = {
      data: {
        nombre_libro: formData.nombre,
        isbn_libro: formData.isbn,
        precio: parseFloat(formData.precio),
        stock_quantity: parseInt(formData.stock) || 0,
        estado_publicacion: "Publicado",
        canales: [1, 2],
        
        rawWooData: {
          name: formData.nombre,
          type: "simple",
          status: "publish",
          sku: formData.isbn,
          
          // âœ… Usar descripciones de campos SEPARADOS
          description: descripcionCompletaHTML,      // Desde formData.descripcion
          short_description: descripcionCortaHTML,   // Desde formData.descripcionCorta
          
          regular_price: formData.precio.toString(),
          manage_stock: true,
          stock_quantity: parseInt(formData.stock) || 0,
          stock_status: parseInt(formData.stock) > 0 ? 'instock' : 'outofstock',
          backorders: 'no'
        }
      }
    };
    
    // Enviar a Strapi
    const response = await fetch('https://strapi.moraleja.cl/api/libros', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    
    if (!response.ok) {
      throw new Error('Error al guardar producto');
    }
    
    console.log('âœ… Producto guardado con descripciones separadas');
    
  } catch (error) {
    console.error('âŒ Error:', error);
  }
};

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PASO 4: FUNCIONES HELPER (MANTENER IGUAL)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function textoAHTML(texto) {
  if (!texto || texto.trim() === '') return '';
  const parrafos = texto.split('\n\n')
    .filter(p => p.trim())
    .map(p => `<p>${p.trim().replace(/\n/g, '<br>')}</p>`)
    .join('');
  return parrafos || `<p>${texto}</p>`;
}

function generarDescripcionCorta(texto, maxCaracteres = 150) {
  if (!texto || texto.trim() === '') return '';
  const textoLimpio = texto.replace(/\n/g, ' ').trim();
  let textoCorto;
  if (textoLimpio.length > maxCaracteres) {
    textoCorto = textoLimpio.substring(0, maxCaracteres);
    const ultimoEspacio = textoCorto.lastIndexOf(' ');
    if (ultimoEspacio > 0) {
      textoCorto = textoCorto.substring(0, ultimoEspacio);
    }
    textoCorto += '...';
  } else {
    textoCorto = textoLimpio;
  }
  return `<p>${textoCorto}</p>`;
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CÃ“DIGO COMPLETO DE EJEMPLO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

import React, { useState } from 'react';

// Funciones helper
function textoAHTML(texto) {
  if (!texto || texto.trim() === '') return '';
  const parrafos = texto.split('\n\n')
    .filter(p => p.trim())
    .map(p => `<p>${p.trim().replace(/\n/g, '<br>')}</p>`)
    .join('');
  return parrafos || `<p>${texto}</p>`;
}

function generarDescripcionCorta(texto, maxCaracteres = 150) {
  if (!texto || texto.trim() === '') return '';
  const textoLimpio = texto.replace(/\n/g, ' ').trim();
  let textoCorto;
  if (textoLimpio.length > maxCaracteres) {
    textoCorto = textoLimpio.substring(0, maxCaracteres);
    const ultimoEspacio = textoCorto.lastIndexOf(' ');
    if (ultimoEspacio > 0) {
      textoCorto = textoCorto.substring(0, ultimoEspacio);
    }
    textoCorto += '...';
  } else {
    textoCorto = textoLimpio;
  }
  return `<p>${textoCorto}</p>`;
}

// Componente del formulario
export default function FormularioProducto() {
  const [formData, setFormData] = useState({
    nombre: '',
    isbn: '',
    precio: '',
    stock: 0,
    descripcion: '',          // âœ… Campo separado 1
    descripcionCorta: '',     // âœ… Campo separado 2
  });
  
  const handleSubmit = async (e) => {
    e.preventDefault();
    
    // Procesar descripciones
    const descripcionCompletaHTML = textoAHTML(formData.descripcion);
    const descripcionCortaHTML = formData.descripcionCorta 
      ? textoAHTML(formData.descripcionCorta)
      : generarDescripcionCorta(formData.descripcion, 150);
    
    const payload = {
      data: {
        nombre_libro: formData.nombre,
        isbn_libro: formData.isbn,
        precio: parseFloat(formData.precio),
        stock_quantity: parseInt(formData.stock) || 0,
        estado_publicacion: "Publicado",
        canales: [1, 2],
        
        rawWooData: {
          name: formData.nombre,
          
          // âœ… Campos separados
          description: descripcionCompletaHTML,
          short_description: descripcionCortaHTML,
          
          regular_price: formData.precio.toString(),
          manage_stock: true,
          stock_quantity: parseInt(formData.stock) || 0
        }
      }
    };
    
    const response = await fetch('https://strapi.moraleja.cl/api/libros', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    
    if (response.ok) {
      alert('âœ… Producto creado con descripciones separadas');
    }
  };
  
  return (
    <form onSubmit={handleSubmit}>
      <div>
        <label>Nombre del producto</label>
        <input
          type="text"
          value={formData.nombre}
          onChange={(e) => setFormData({...formData, nombre: e.target.value})}
        />
      </div>
      
      <div>
        <label>ISBN</label>
        <input
          type="text"
          value={formData.isbn}
          onChange={(e) => setFormData({...formData, isbn: e.target.value})}
        />
      </div>
      
      <div>
        <label>Precio</label>
        <input
          type="number"
          value={formData.precio}
          onChange={(e) => setFormData({...formData, precio: e.target.value})}
        />
      </div>
      
      <div>
        <label>Stock</label>
        <input
          type="number"
          value={formData.stock}
          onChange={(e) => setFormData({...formData, stock: e.target.value})}
        />
      </div>
      
      {/* âœ… CAMPO 1: DescripciÃ³n completa */}
      <div>
        <label>DescripciÃ³n del producto (completa)</label>
        <textarea
          value={formData.descripcion}
          onChange={(e) => setFormData({...formData, descripcion: e.target.value})}
          rows={10}
          placeholder="DescripciÃ³n completa del producto con todos los detalles"
        />
      </div>
      
      {/* âœ… CAMPO 2: DescripciÃ³n corta */}
      <div>
        <label>DescripciÃ³n corta</label>
        <textarea
          value={formData.descripcionCorta}
          onChange={(e) => setFormData({...formData, descripcionCorta: e.target.value})}
          rows={3}
          placeholder="Resumen breve del producto (150-200 caracteres)"
          maxLength={200}
        />
        <small>Caracteres: {formData.descripcionCorta.length}/200</small>
      </div>
      
      <button type="submit">Crear Producto</button>
    </form>
  );
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
AL EDITAR UN PRODUCTO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Cuando cargas un producto para editar, debes llenar AMBOS campos:

const cargarProducto = async (productoId) => {
  const response = await fetch(
    `https://strapi.moraleja.cl/api/libros/${productoId}?populate=*`
  );
  const data = await response.json();
  const producto = data.data.attributes;
  
  // Convertir descripcion (blocks) a texto
  let descripcionTexto = '';
  if (producto.descripcion && Array.isArray(producto.descripcion)) {
    descripcionTexto = producto.descripcion
      .map(block => {
        if (block.children && Array.isArray(block.children)) {
          return block.children.map(child => child.text || '').join('');
        }
        return '';
      })
      .join('\n\n');
  }
  
  // Llenar AMBOS campos
  setFormData({
    nombre: producto.nombre_libro,
    isbn: producto.isbn_libro,
    precio: producto.precio,
    stock: producto.stock_quantity,
    descripcion: descripcionTexto || '',           // âœ… Campo completo
    descripcionCorta: producto.subtitulo_libro || '',  // âœ… Campo corto
  });
};

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
VALIDACIONES RECOMENDADAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function validarFormulario(formData) {
  const errores = {};
  
  // DescripciÃ³n completa es requerida
  if (!formData.descripcion || formData.descripcion.trim() === '') {
    errores.descripcion = 'La descripciÃ³n del producto es requerida';
  }
  
  if (formData.descripcion && formData.descripcion.length < 20) {
    errores.descripcion = 'La descripciÃ³n debe tener al menos 20 caracteres';
  }
  
  // DescripciÃ³n corta es opcional, pero si existe debe ser razonable
  if (formData.descripcionCorta && formData.descripcionCorta.length < 10) {
    errores.descripcionCorta = 'La descripciÃ³n corta debe tener al menos 10 caracteres';
  }
  
  if (formData.descripcionCorta && formData.descripcionCorta.length > 250) {
    errores.descripcionCorta = 'La descripciÃ³n corta no debe exceder 250 caracteres';
  }
  
  return errores;
}

// Usar antes de enviar
const errores = validarFormulario(formData);
if (Object.keys(errores).length > 0) {
  alert(Object.values(errores).join('\n'));
  return;
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
VERIFICAR QUE FUNCIONA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. LLENAR AMBOS CAMPOS EN EL FORMULARIO:
   - DescripciÃ³n del producto: "Este es un libro completo de cÃ¡lculo..."
   - DescripciÃ³n corta: "Libro de cÃ¡lculo para ingenierÃ­a"

2. VER EN CONSOLA ANTES DE ENVIAR:
   console.log('Description:', payload.data.rawWooData.description);
   console.log('Short description:', payload.data.rawWooData.short_description);
   
   DEBE MOSTRAR TEXTOS DIFERENTES

3. DESPUÃ‰S DE CREAR, VERIFICAR EN WOOCOMMERCE:
   - Tab "DescripciÃ³n" â†’ Debe tener el texto largo
   - Tab "DescripciÃ³n corta" â†’ Debe tener el texto corto

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RESUMEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CAMBIOS NECESARIOS:

1. âœ… Agregar campo "descripcionCorta" al estado:
   const [formData, setFormData] = useState({
     descripcion: '',
     descripcionCorta: '',  // â† AGREGAR ESTE
   });

2. âœ… Agregar textarea para descripciÃ³n corta en el formulario:
   <textarea
     value={formData.descripcionCorta}
     onChange={(e) => setFormData({...formData, descripcionCorta: e.target.value})}
   />

3. âœ… Usar ambos campos en el payload:
   description: textoAHTML(formData.descripcion),
   short_description: formData.descripcionCorta 
     ? textoAHTML(formData.descripcionCorta)
     : generarDescripcionCorta(formData.descripcion, 150)

RESULTADO:
âœ… Lo que escribes en "DescripciÃ³n del producto" va a description
âœ… Lo que escribes en "DescripciÃ³n corta" va a short_description
âœ… Ambos campos son INDEPENDIENTES

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

IMPLEMENTA ESTOS CAMBIOS Y LOS DOS CAMPOS FUNCIONARÃN CORRECTAMENTE
DE FORMA INDEPENDIENTE.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

