â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¢ SOLUCIÃ“N DEFINITIVA: Descripciones en WooCommerce
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PROBLEMAS A RESOLVER:
1. âŒ Las descripciones NO aparecen en WooCommerce (estÃ¡n vacÃ­as)
2. âŒ Cuando aparecen, ambas descripciones muestran el MISMO texto completo

SOLUCIÃ“N COMPLETA:
âœ… Incluir descripciones en rawWooData
âœ… Usar funciones helper para convertir texto a HTML
âœ… Limitar descripciÃ³n corta a 150 caracteres

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PASO 1: AGREGAR FUNCIONES HELPER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Agrega estas dos funciones al inicio del archivo donde creas/editas productos:

// FunciÃ³n 1: Convierte texto plano a HTML con pÃ¡rrafos
function textoAHTML(texto) {
  if (!texto || texto.trim() === '') return '';
  
  // Convertir saltos de lÃ­nea dobles en pÃ¡rrafos
  const parrafos = texto.split('\n\n')
    .filter(p => p.trim())
    .map(p => `<p>${p.trim().replace(/\n/g, '<br>')}</p>`)
    .join('');
  
  return parrafos || `<p>${texto}</p>`;
}

// FunciÃ³n 2: Genera descripciÃ³n CORTA limitada a X caracteres
function generarDescripcionCorta(texto, maxCaracteres = 150) {
  if (!texto || texto.trim() === '') return '';
  
  // Limpiar saltos de lÃ­nea y convertir a una sola lÃ­nea
  const textoLimpio = texto.replace(/\n/g, ' ').trim();
  
  // Limitar a X caracteres
  let textoCorto;
  if (textoLimpio.length > maxCaracteres) {
    // Cortar en la Ãºltima palabra completa antes del lÃ­mite
    textoCorto = textoLimpio.substring(0, maxCaracteres);
    const ultimoEspacio = textoCorto.lastIndexOf(' ');
    if (ultimoEspacio > 0) {
      textoCorto = textoCorto.substring(0, ultimoEspacio);
    }
    textoCorto += '...';
  } else {
    textoCorto = textoLimpio;
  }
  
  return `<p>${textoCorto}</p>`;
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PASO 2: USAR EN EL PAYLOAD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

En tu funciÃ³n de crear/actualizar producto, construye el payload asÃ­:

const handleSubmit = async (formData) => {
  try {
    // âœ… Procesar descripciones con las funciones helper
    const descripcionCompleta = textoAHTML(formData.descripcion);
    const descripcionCorta = generarDescripcionCorta(formData.descripcion, 150);
    
    // Debug (opcional - ver en consola)
    console.log('ğŸ“ DescripciÃ³n completa:', descripcionCompleta.length, 'caracteres');
    console.log('ğŸ“ DescripciÃ³n corta:', descripcionCorta.length, 'caracteres');
    
    const payload = {
      data: {
        nombre_libro: formData.nombre,
        isbn_libro: formData.isbn,
        precio: parseFloat(formData.precio),
        stock_quantity: parseInt(formData.stock) || 0,
        estado_publicacion: "Publicado",
        canales: [1, 2], // 1 = moraleja, 2 = escolar
        
        rawWooData: {
          name: formData.nombre,
          type: "simple",
          status: "publish",
          sku: formData.isbn,
          
          // âœ… CRÃTICO: Incluir descripciones procesadas
          description: descripcionCompleta,      // HTML completo
          short_description: descripcionCorta,   // Limitado a 150 chars
          
          regular_price: formData.precio.toString(),
          sale_price: formData.precio_oferta?.toString() || '',
          
          manage_stock: true,
          stock_quantity: parseInt(formData.stock) || 0,
          stock_status: parseInt(formData.stock) > 0 ? 'instock' : 'outofstock',
          backorders: 'no',
          backorders_allowed: false,
          
          weight: formData.peso || '',
          dimensions: {
            length: formData.largo || '',
            width: formData.ancho || '',
            height: formData.alto || ''
          },
          shipping_class: formData.clase_envio || '',
          
          images: formData.imagenUrl ? [
            {
              src: formData.imagenUrl,
              name: formData.nombre,
              alt: formData.nombre
            }
          ] : []
        }
      }
    };
    
    // Enviar a Strapi
    const endpoint = modoEdicion
      ? `https://strapi.moraleja.cl/api/libros/${productoId}`
      : 'https://strapi.moraleja.cl/api/libros';
    
    const response = await fetch(endpoint, {
      method: modoEdicion ? 'PUT' : 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    
    if (!response.ok) {
      const error = await response.json();
      throw new Error(error.error?.message || 'Error al guardar producto');
    }
    
    console.log('âœ… Producto guardado con descripciones correctas');
    
    // Redirigir o mostrar mensaje de Ã©xito
    alert('âœ… Producto guardado exitosamente');
    
  } catch (error) {
    console.error('âŒ Error:', error);
    alert('âŒ Error al guardar: ' + error.message);
  }
};

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PASO 3: VALIDACIONES (OPCIONAL PERO RECOMENDADO)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Antes de enviar el payload, valida que las descripciones no estÃ©n vacÃ­as:

function validarFormulario(formData) {
  const errores = {};
  
  if (!formData.descripcion || formData.descripcion.trim() === '') {
    errores.descripcion = 'La descripciÃ³n es requerida';
  }
  
  if (formData.descripcion && formData.descripcion.length < 10) {
    errores.descripcion = 'La descripciÃ³n debe tener al menos 10 caracteres';
  }
  
  return errores;
}

// Usar en handleSubmit:
const errores = validarFormulario(formData);
if (Object.keys(errores).length > 0) {
  console.error('Errores de validaciÃ³n:', errores);
  alert('Por favor completa la descripciÃ³n del producto');
  return;
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EJEMPLO COMPLETO DE RESULTADO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ENTRADA (formData.descripcion):
"CÃ¡lculo I es un libro fundamental para estudiantes de ingenierÃ­a y ciencias.

Incluye mÃ¡s de 500 ejercicios resueltos paso a paso, con explicaciones detalladas de cada concepto matemÃ¡tico.

Los temas cubiertos incluyen lÃ­mites, derivadas, integrales y sus aplicaciones prÃ¡cticas."

SALIDA EN rawWooData:

description:
"<p>CÃ¡lculo I es un libro fundamental para estudiantes de ingenierÃ­a y ciencias.</p>
<p>Incluye mÃ¡s de 500 ejercicios resueltos paso a paso, con explicaciones detalladas de cada concepto matemÃ¡tico.</p>
<p>Los temas cubiertos incluyen lÃ­mites, derivadas, integrales y sus aplicaciones prÃ¡cticas.</p>"

short_description:
"<p>CÃ¡lculo I es un libro fundamental para estudiantes de ingenierÃ­a y ciencias. Incluye mÃ¡s de 500 ejercicios resueltos paso a...</p>"

RESULTADO EN WOOCOMMERCE:
âœ… DescripciÃ³n completa: Todo el texto con formato de pÃ¡rrafos
âœ… DescripciÃ³n corta: Solo las primeras 150 caracteres

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
VERIFICAR QUE FUNCIONA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. CREAR UN PRODUCTO DE PRUEBA
   - Llenar el campo descripciÃ³n con texto largo (200+ caracteres)
   - Guardar el producto
   
2. VER EN CONSOLA DEL NAVEGADOR
   Debe mostrar:
   ğŸ“ DescripciÃ³n completa: 300 caracteres
   ğŸ“ DescripciÃ³n corta: 153 caracteres
   
3. VERIFICAR EN WOOCOMMERCE ADMIN
   - Ir a: https://moraleja.cl/wp-admin/edit.php?post_type=product
   - Editar el producto reciÃ©n creado
   - Tab "DescripciÃ³n" â†’ Debe tener todo el texto
   - Tab "DescripciÃ³n corta" â†’ Debe tener solo ~150 caracteres
   
4. VERIFICAR EN EL FRONTEND
   - Ir a la pÃ¡gina del producto en la tienda
   - La descripciÃ³n completa debe aparecer en el tab "DescripciÃ³n"
   - La descripciÃ³n corta debe aparecer en listados de productos

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
DEBUGGING SI NO FUNCIONA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Si despuÃ©s de implementar SIGUE sin funcionar:

1. Verificar que las funciones estÃ¡n definidas:
   console.log('Â¿textoAHTML existe?', typeof textoAHTML === 'function');
   console.log('Â¿generarDescripcionCorta existe?', typeof generarDescripcionCorta === 'function');
   
2. Verificar que formData.descripcion tiene valor:
   console.log('formData.descripcion:', formData.descripcion);
   
3. Verificar las descripciones procesadas:
   console.log('descripcionCompleta:', descripcionCompleta);
   console.log('descripcionCorta:', descripcionCorta);
   
4. Verificar que son DIFERENTES:
   console.log('Â¿Son diferentes?', descripcionCompleta !== descripcionCorta);
   // Debe mostrar: true
   
5. Ver el payload completo antes de enviar:
   console.log('Payload completo:', JSON.stringify(payload, null, 2));

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
AJUSTES OPCIONALES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CAMBIAR LONGITUD DE DESCRIPCIÃ“N CORTA:

// MÃ¡s corta (100 caracteres)
const descripcionCorta = generarDescripcionCorta(formData.descripcion, 100);

// Normal (150 caracteres) - RECOMENDADO
const descripcionCorta = generarDescripcionCorta(formData.descripcion, 150);

// MÃ¡s larga (200 caracteres)
const descripcionCorta = generarDescripcionCorta(formData.descripcion, 200);

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CÃ“DIGO PARA EDITAR PRODUCTOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Al EDITAR un producto, necesitas convertir el formato blocks de Strapi
de vuelta a texto para mostrarlo en el formulario:

const cargarProducto = async (productoId) => {
  const response = await fetch(
    `https://strapi.moraleja.cl/api/libros/${productoId}?populate=*`
  );
  const data = await response.json();
  const producto = data.data.attributes;
  
  // Convertir descripcion (blocks) a texto plano
  let descripcionTexto = '';
  if (producto.descripcion && Array.isArray(producto.descripcion)) {
    descripcionTexto = producto.descripcion
      .map(block => {
        if (block.children && Array.isArray(block.children)) {
          return block.children.map(child => child.text || '').join('');
        }
        return '';
      })
      .join('\n\n');
  }
  
  // Llenar formulario
  setFormData({
    nombre: producto.nombre_libro,
    isbn: producto.isbn_libro,
    precio: producto.precio,
    stock: producto.stock_quantity,
    descripcion: descripcionTexto || producto.subtitulo_libro || '',
  });
};

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RESUMEN EJECUTIVO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

IMPLEMENTACIÃ“N EN 3 PASOS:

1. COPIAR las dos funciones helper (textoAHTML y generarDescripcionCorta)
   
2. AGREGAR en el payload:
   description: textoAHTML(formData.descripcion)
   short_description: generarDescripcionCorta(formData.descripcion, 150)
   
3. PROBAR creando un producto con descripciÃ³n larga

RESULTADO:
âœ… Descripciones aparecen en WooCommerce
âœ… DescripciÃ³n completa: Texto completo con formato HTML
âœ… DescripciÃ³n corta: Solo 150 caracteres
âœ… Ambas descripciones son DIFERENTES

TIEMPO ESTIMADO:
10-15 minutos de implementaciÃ³n

PRIORIDAD:
ğŸ”´ URGENTE - Implementar inmediatamente

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

IMPLEMENTA ESTAS FUNCIONES Y EL PROBLEMA DE DESCRIPCIONES QUEDARÃ
COMPLETAMENTE RESUELTO.

DESPUÃ‰S DE IMPLEMENTAR, CREA UN PRODUCTO DE PRUEBA Y VERIFICA QUE
LAS DESCRIPCIONES APAREZCAN CORRECTAMENTE EN WOOCOMMERCE.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

