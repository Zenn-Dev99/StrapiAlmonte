â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ–¼ï¸ PROBLEMA: Imagen y Descripciones NO se cargan a WooCommerce
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CAMPOS AFECTADOS:
âŒ Imagen del producto (images)
âŒ DescripciÃ³n completa (description)
âŒ DescripciÃ³n corta (short_description)

CAUSA:
Estos campos NO se estÃ¡n enviando correctamente en el payload o estÃ¡n
en formato incorrecto.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SOLUCIÃ“N COMPLETA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. IMAGEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

La imagen debe ir en rawWooData.images como un array de objetos con:
- src: URL completa de la imagen
- name: Nombre descriptivo
- alt: Texto alternativo

FORMATO CORRECTO:

rawWooData: {
  images: [
    {
      src: "https://cdn.moraleja.cl/productos/imagen-producto.jpg",
      name: "Portada del libro",
      alt: "CÃ¡lculo I - 10Âª EdiciÃ³n"
    }
  ]
}

IMPORTANTE:
âœ… La URL debe ser accesible pÃºblicamente
âœ… Debe estar en formato HTTPS
âœ… Debe ser un array, aunque sea una sola imagen
âœ… Si tienes mÃºltiples imÃ¡genes, agrega mÃ¡s objetos al array

EJEMPLO CON MÃšLTIPLES IMÃGENES:

rawWooData: {
  images: [
    {
      src: "https://cdn.moraleja.cl/productos/portada.jpg",
      name: "Portada",
      alt: "Portada del libro"
    },
    {
      src: "https://cdn.moraleja.cl/productos/contraportada.jpg",
      name: "Contraportada",
      alt: "Contraportada del libro"
    }
  ]
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

2. DESCRIPCIÃ“N COMPLETA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

La descripciÃ³n debe ir en rawWooData.description como HTML string.

FORMATO CORRECTO:

rawWooData: {
  description: "<p>Esta es la descripciÃ³n <strong>completa</strong> del producto.</p><p>Puede incluir mÃºltiples pÃ¡rrafos, listas, etc.</p>"
}

OPCIONES:

OpciÃ³n A - HTML Simple:
description: "<p>DescripciÃ³n del producto en formato HTML</p>"

OpciÃ³n B - HTML Completo con formato:
description: `
  <div>
    <h3>Sobre este libro</h3>
    <p>CÃ¡lculo I es un libro fundamental para estudiantes de ingenierÃ­a.</p>
    
    <h4>CaracterÃ­sticas:</h4>
    <ul>
      <li>10Âª EdiciÃ³n actualizada</li>
      <li>MÃ¡s de 500 ejercicios</li>
      <li>Soluciones paso a paso</li>
    </ul>
    
    <h4>Contenido:</h4>
    <ol>
      <li>LÃ­mites y continuidad</li>
      <li>Derivadas</li>
      <li>Integrales</li>
    </ol>
  </div>
`

OpciÃ³n C - Convertir texto plano a HTML:
// Si tienes texto plano, conviÃ©rtelo a HTML
const textoPlano = formData.descripcion;
const descripcionHTML = `<p>${textoPlano.replace(/\n\n/g, '</p><p>').replace(/\n/g, '<br>')}</p>`;

rawWooData: {
  description: descripcionHTML
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

3. DESCRIPCIÃ“N CORTA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

La descripciÃ³n corta debe ir en rawWooData.short_description como HTML string.

FORMATO CORRECTO:

rawWooData: {
  short_description: "<p>Resumen breve del producto en 1-2 lÃ­neas.</p>"
}

RECOMENDACIÃ“N:
- MÃ¡ximo 150-200 caracteres
- Debe ser un resumen atractivo del producto
- Puede generarse automÃ¡ticamente desde la descripciÃ³n completa

EJEMPLO:

// OpciÃ³n 1: Campo especÃ­fico del formulario
rawWooData: {
  short_description: `<p>${formData.resumen}</p>`
}

// OpciÃ³n 2: Auto-generado desde descripciÃ³n (primeros 150 caracteres)
const descripcionCorta = formData.descripcion
  ? formData.descripcion.substring(0, 150) + '...'
  : '';

rawWooData: {
  short_description: `<p>${descripcionCorta}</p>`
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PAYLOAD COMPLETO CORRECTO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

En tu funciÃ³n de crear/actualizar producto, construye el payload asÃ­:

const payload = {
  data: {
    nombre_libro: formData.nombre_libro,
    isbn_libro: formData.isbn,
    precio: parseFloat(formData.precio),
    stock_quantity: parseInt(formData.stock) || 0,
    estado_publicacion: "Publicado",
    canales: [1, 2], // 1 = moraleja, 2 = escolar
    
    rawWooData: {
      // InformaciÃ³n bÃ¡sica
      name: formData.nombre_libro,
      type: "simple",
      status: "publish",
      
      // âœ… DESCRIPCIÃ“N COMPLETA (HTML)
      description: formData.descripcion 
        ? `<p>${formData.descripcion.replace(/\n\n/g, '</p><p>').replace(/\n/g, '<br>')}</p>`
        : '',
      
      // âœ… DESCRIPCIÃ“N CORTA (HTML, mÃ¡ximo 150 caracteres)
      short_description: formData.descripcion
        ? `<p>${formData.descripcion.substring(0, 150)}...</p>`
        : '',
      
      // Precio
      regular_price: formData.precio.toString(),
      sale_price: formData.precio_oferta?.toString() || '',
      
      // Stock
      manage_stock: true,
      stock_quantity: parseInt(formData.stock) || 0,
      stock_status: parseInt(formData.stock) > 0 ? 'instock' : 'outofstock',
      backorders: 'no',
      
      // Dimensiones
      weight: formData.peso || '',
      dimensions: {
        length: formData.largo || '',
        width: formData.ancho || '',
        height: formData.alto || ''
      },
      
      // âœ… IMÃGENES (array de objetos)
      images: formData.imagenUrl ? [
        {
          src: formData.imagenUrl,
          name: formData.nombre_libro,
          alt: formData.nombre_libro
        }
      ] : []
    }
  }
};

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CASOS ESPECÃFICOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CASO 1: Si subes imagen a Strapi primero
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// 1. Subir imagen a Strapi
const formDataImagen = new FormData();
formDataImagen.append('files', archivoImagen);

const responseImagen = await fetch('https://strapi.moraleja.cl/api/upload', {
  method: 'POST',
  body: formDataImagen
});

const imagenSubida = await responseImagen.json();
const urlImagen = `https://strapi.moraleja.cl${imagenSubida[0].url}`;

// 2. Usar esa URL en rawWooData
rawWooData: {
  images: [
    {
      src: urlImagen,
      name: formData.nombre_libro,
      alt: formData.nombre_libro
    }
  ]
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CASO 2: Si la imagen ya estÃ¡ en un CDN/servidor
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// Usar directamente la URL del CDN
rawWooData: {
  images: [
    {
      src: formData.urlImagenCDN, // URL desde input del formulario
      name: formData.nombre_libro,
      alt: formData.nombre_libro
    }
  ]
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CASO 3: Si usas un selector de imÃ¡genes de Strapi
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// Obtener URL de la imagen seleccionada de Strapi
const imagenStrapi = formData.portada_libro; // ID o URL

// Si es ID, obtener la URL:
const responseImg = await fetch(`https://strapi.moraleja.cl/api/upload/files/${imagenStrapi}`);
const imgData = await responseImg.json();
const urlImagen = `https://strapi.moraleja.cl${imgData.url}`;

rawWooData: {
  images: [
    {
      src: urlImagen,
      name: formData.nombre_libro,
      alt: formData.nombre_libro
    }
  ]
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EJEMPLO COMPLETO EN EL FORMULARIO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// En tu componente de formulario (agregar/editar producto)

const handleSubmit = async (formData) => {
  try {
    // 1. Subir imagen si existe (opcional)
    let urlImagen = formData.imagenExistente || '';
    
    if (formData.nuevaImagen) {
      const formDataImg = new FormData();
      formDataImg.append('files', formData.nuevaImagen);
      
      const resImg = await fetch('https://strapi.moraleja.cl/api/upload', {
        method: 'POST',
        body: formDataImg
      });
      
      const imgSubida = await resImg.json();
      urlImagen = `https://strapi.moraleja.cl${imgSubida[0].url}`;
    }
    
    // 2. Construir payload completo
    const payload = {
      data: {
        nombre_libro: formData.nombre,
        isbn_libro: formData.isbn,
        precio: parseFloat(formData.precio),
        estado_publicacion: "Publicado",
        canales: [1, 2],
        
        rawWooData: {
          name: formData.nombre,
          
          // âœ… DescripciÃ³n en HTML
          description: formData.descripcion
            ? `<p>${formData.descripcion.replace(/\n\n/g, '</p><p>').replace(/\n/g, '<br>')}</p>`
            : '<p>Sin descripciÃ³n</p>',
          
          // âœ… DescripciÃ³n corta en HTML
          short_description: formData.descripcion
            ? `<p>${formData.descripcion.substring(0, 150)}...</p>`
            : '<p>Sin descripciÃ³n</p>',
          
          regular_price: formData.precio.toString(),
          manage_stock: true,
          stock_quantity: parseInt(formData.stock) || 0,
          
          // âœ… ImÃ¡genes
          images: urlImagen ? [
            {
              src: urlImagen,
              name: formData.nombre,
              alt: formData.nombre
            }
          ] : []
        }
      }
    };
    
    // 3. Enviar a Strapi
    const endpoint = modoEdicion
      ? `https://strapi.moraleja.cl/api/libros/${productoId}`
      : 'https://strapi.moraleja.cl/api/libros';
    
    const response = await fetch(endpoint, {
      method: modoEdicion ? 'PUT' : 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(payload)
    });
    
    if (!response.ok) {
      throw new Error('Error al guardar producto');
    }
    
    console.log('âœ… Producto guardado con imagen y descripciones');
    
  } catch (error) {
    console.error('âŒ Error:', error);
  }
};

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
VALIDACIONES RECOMENDADAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Antes de enviar el payload, valida:

1. IMAGEN:
   - Verifica que la URL sea vÃ¡lida
   - Verifica que sea HTTPS
   - Verifica que el formato sea .jpg, .png, .webp

2. DESCRIPCIÃ“N:
   - MÃ­nimo 10 caracteres
   - Convertir a HTML si es texto plano

3. DESCRIPCIÃ“N CORTA:
   - MÃ¡ximo 200 caracteres
   - Auto-generar si no existe

Ejemplo de validaciÃ³n:

const validarYPrepararDatos = (formData) => {
  // Validar imagen
  const imagenUrl = formData.imagenUrl || '';
  if (imagenUrl && !imagenUrl.startsWith('https://')) {
    console.warn('âš ï¸ La URL de la imagen debe ser HTTPS');
  }
  
  // Validar descripciÃ³n
  if (!formData.descripcion || formData.descripcion.length < 10) {
    throw new Error('La descripciÃ³n debe tener al menos 10 caracteres');
  }
  
  // Preparar descripciÃ³n HTML
  const descripcionHTML = `<p>${formData.descripcion.replace(/\n\n/g, '</p><p>').replace(/\n/g, '<br>')}</p>`;
  
  // Preparar descripciÃ³n corta
  const descripcionCorta = formData.descripcion.substring(0, 150) + '...';
  const descripcionCortaHTML = `<p>${descripcionCorta}</p>`;
  
  return {
    descripcionHTML,
    descripcionCortaHTML,
    imagenUrl
  };
};

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
VERIFICAR QUE FUNCIONA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

DespuÃ©s de crear/actualizar un producto:

1. Ver en consola del navegador:
   console.log('Payload enviado:', payload);

2. Ver en WooCommerce Admin:
   - Ir a Productos â†’ Editar producto
   - Verificar que aparece la imagen
   - Verificar que aparece la descripciÃ³n completa
   - Verificar que aparece la descripciÃ³n corta

3. Ver en el frontend de WooCommerce:
   - Ir a la pÃ¡gina del producto
   - Verificar que se ve la imagen
   - Verificar que se ve la descripciÃ³n

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RESUMEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… IMAGEN:
   rawWooData.images = [{ src: "url", name: "nombre", alt: "alt" }]

âœ… DESCRIPCIÃ“N COMPLETA:
   rawWooData.description = "<p>HTML con formato</p>"

âœ… DESCRIPCIÃ“N CORTA:
   rawWooData.short_description = "<p>Resumen breve</p>"

âŒ NO enviar como:
   - data.descripcion (no existe en Strapi para este propÃ³sito)
   - data.images (no existe en Strapi)
   - rawWooData.description sin HTML (debe tener <p> tags)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

POR FAVOR IMPLEMENTA ESTOS CAMBIOS EN TU CÃ“DIGO DE CREAR/EDITAR
PRODUCTOS PARA QUE LAS IMÃGENES Y DESCRIPCIONES SE SINCRONICEN
CORRECTAMENTE CON WOOCOMMERCE.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

