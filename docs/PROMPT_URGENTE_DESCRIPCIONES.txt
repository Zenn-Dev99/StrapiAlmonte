â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸš¨ URGENTE: Las descripciones NO aparecen en WooCommerce
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PROBLEMA ACTUAL:
âŒ Los productos se crean en WooCommerce
âŒ PERO las descripciones estÃ¡n VACÃAS
âŒ description: vacÃ­o
âŒ short_description: vacÃ­o

CAUSA:
EstÃ¡s enviando rawWooData PERO SIN incluir description y short_description

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SOLUCIÃ“N INMEDIATA (2 OPCIONES)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OPCIÃ“N 1: INCLUIR DESCRIPCIONES EN rawWooData (RECOMENDADO)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

{
  data: {
    nombre_libro: "CÃ¡lculo I",
    precio: 49990,
    canales: [1, 2],
    
    rawWooData: {
      name: "CÃ¡lculo I",
      regular_price: "49990.00",
      manage_stock: true,
      stock_quantity: 100,
      
      // âœ… AGREGAR ESTOS CAMPOS:
      description: "<p>DescripciÃ³n completa del producto</p>",
      short_description: "<p>Resumen breve del producto</p>"
    }
  }
}

OPCIÃ“N 2: ENVIAR DESCRIPCIÃ“N EN CAMPO DE STRAPI (AUTOMÃTICO)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Si no quieres incluir descripciones en rawWooData, Strapi las completarÃ¡
automÃ¡ticamente DESDE el campo "descripcion" de Strapi.

{
  data: {
    nombre_libro: "CÃ¡lculo I",
    precio: 49990,
    canales: [1, 2],
    
    // âœ… Enviar descripciÃ³n en formato blocks
    descripcion: [
      {
        type: "paragraph",
        children: [
          { type: "text", text: "DescripciÃ³n completa del producto" }
        ]
      }
    ],
    
    // âœ… Enviar descripciÃ³n corta en subtitulo_libro
    subtitulo_libro: "Resumen breve del producto",
    
    rawWooData: {
      name: "CÃ¡lculo I",
      regular_price: "49990.00",
      manage_stock: true,
      stock_quantity: 100
      // âœ… NO necesitas description/short_description aquÃ­
      // Strapi los agregarÃ¡ automÃ¡ticamente desde descripcion/subtitulo_libro
    }
  }
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FUNCIONES HELPER PARA OPCIÃ“N 1 (RECOMENDADO)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Convierte texto plano a HTML con pÃ¡rrafos
function textoAHTML(texto) {
  if (!texto) return '';
  
  // Convertir saltos de lÃ­nea dobles en pÃ¡rrafos
  const parrafos = texto.split('\n\n')
    .filter(p => p.trim())
    .map(p => `<p>${p.trim().replace(/\n/g, '<br>')}</p>`)
    .join('');
  
  return parrafos || `<p>${texto}</p>`;
}

// Genera descripciÃ³n corta (mÃ¡ximo X caracteres)
function generarDescripcionCorta(texto, maxCaracteres = 150) {
  if (!texto) return '';
  
  const textoLimpio = texto.replace(/\n/g, ' ').trim();
  const textoCorto = textoLimpio.length > maxCaracteres
    ? textoLimpio.substring(0, maxCaracteres) + '...'
    : textoLimpio;
  
  return `<p>${textoCorto}</p>`;
}

// Uso en el formulario:
const descripcionHTML = textoAHTML(formData.descripcion);
const descripcionCortaHTML = generarDescripcionCorta(formData.descripcion, 150);

const payload = {
  data: {
    nombre_libro: formData.nombre,
    precio: parseFloat(formData.precio),
    canales: [1, 2],
    
    rawWooData: {
      name: formData.nombre,
      regular_price: formData.precio.toString(),
      
      // âœ… Usar las funciones helper
      description: descripcionHTML,
      short_description: descripcionCortaHTML,
      
      manage_stock: true,
      stock_quantity: parseInt(formData.stock) || 0
    }
  }
};

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
IMPLEMENTACIÃ“N COMPLETA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 1. Agregar funciones helper al inicio del archivo
function textoAHTML(texto) {
  if (!texto) return '';
  const parrafos = texto.split('\n\n')
    .filter(p => p.trim())
    .map(p => `<p>${p.trim().replace(/\n/g, '<br>')}</p>`)
    .join('');
  return parrafos || `<p>${texto}</p>`;
}

function generarDescripcionCorta(texto, max = 150) {
  if (!texto) return '';
  const limpio = texto.replace(/\n/g, ' ').trim();
  const corto = limpio.length > max ? limpio.substring(0, max) + '...' : limpio;
  return `<p>${corto}</p>`;
}

// 2. En tu funciÃ³n de crear/actualizar producto
const handleSubmit = async (formData) => {
  try {
    const payload = {
      data: {
        nombre_libro: formData.nombre,
        isbn_libro: formData.isbn,
        precio: parseFloat(formData.precio),
        stock_quantity: parseInt(formData.stock) || 0,
        estado_publicacion: "Publicado",
        canales: [1, 2],
        
        rawWooData: {
          name: formData.nombre,
          type: "simple",
          status: "publish",
          sku: formData.isbn,
          
          // âœ… CRÃTICO: Incluir descripciones en HTML
          description: textoAHTML(formData.descripcion),
          short_description: generarDescripcionCorta(formData.descripcion),
          
          regular_price: formData.precio.toString(),
          sale_price: formData.precio_oferta?.toString() || '',
          
          manage_stock: true,
          stock_quantity: parseInt(formData.stock) || 0,
          stock_status: parseInt(formData.stock) > 0 ? 'instock' : 'outofstock',
          backorders: 'no',
          backorders_allowed: false,
          
          weight: formData.peso || '',
          dimensions: {
            length: formData.largo || '',
            width: formData.ancho || '',
            height: formData.alto || ''
          },
          shipping_class: formData.clase_envio || '',
          
          images: formData.imagenUrl ? [
            {
              src: formData.imagenUrl,
              name: formData.nombre,
              alt: formData.nombre
            }
          ] : []
        }
      }
    };
    
    const endpoint = modoEdicion
      ? `https://strapi.moraleja.cl/api/libros/${productoId}`
      : 'https://strapi.moraleja.cl/api/libros';
    
    const response = await fetch(endpoint, {
      method: modoEdicion ? 'PUT' : 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    
    if (!response.ok) {
      const error = await response.json();
      throw new Error(error.error?.message || 'Error al guardar');
    }
    
    console.log('âœ… Producto guardado con descripciones');
    
  } catch (error) {
    console.error('âŒ Error:', error);
  }
};

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
VERIFICAR QUE FUNCIONA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Ver el payload en consola ANTES de enviar:
   console.log('Payload:', JSON.stringify(payload, null, 2));
   
2. Verificar que rawWooData tiene:
   âœ… description: "<p>..."
   âœ… short_description: "<p>..."

3. DespuÃ©s de crear, ir a WooCommerce Admin:
   https://moraleja.cl/wp-admin/post.php?post=XXX&action=edit
   
4. Verificar que las descripciones aparecen:
   âœ… Tab "DescripciÃ³n" â†’ debe tener contenido
   âœ… Tab "DescripciÃ³n corta" â†’ debe tener contenido

5. Ver en el frontend:
   https://moraleja.cl/producto/nombre-producto/
   âœ… Debe mostrar la descripciÃ³n completa

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
DEBUGGING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Si despuÃ©s de implementar esto SIGUE sin funcionar:

1. Ver el payload completo en consola:
   console.log('rawWooData:', payload.data.rawWooData);

2. Verificar que description NO estÃ© vacÃ­o:
   console.log('description:', payload.data.rawWooData.description);
   // Debe mostrar: "<p>Texto aquÃ­</p>"

3. Verificar que short_description NO estÃ© vacÃ­o:
   console.log('short_description:', payload.data.rawWooData.short_description);
   // Debe mostrar: "<p>Texto aquÃ­</p>"

4. Si estÃ¡n vacÃ­os:
   - Verificar que formData.descripcion tiene valor
   - Verificar que las funciones helper estÃ¡n definidas
   - Verificar que estÃ¡s llamando a las funciones correctamente

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RESUMEN RÃPIDO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

EL PROBLEMA:
rawWooData NO incluye description ni short_description

LA SOLUCIÃ“N:
rawWooData: {
  description: textoAHTML(formData.descripcion),
  short_description: generarDescripcionCorta(formData.descripcion)
}

PRIORIDAD:
ğŸ”´ URGENTE - Implementar AHORA para que las descripciones aparezcan

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

IMPLEMENTA LAS FUNCIONES HELPER Y ACTUALIZA EL PAYLOAD PARA INCLUIR
DESCRIPTION Y SHORT_DESCRIPTION EN rawWooData.

DESPUÃ‰S DE IMPLEMENTAR, PRUEBA CREANDO UN PRODUCTO Y VERIFICA QUE
LAS DESCRIPCIONES APAREZCAN EN WOOCOMMERCE.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

