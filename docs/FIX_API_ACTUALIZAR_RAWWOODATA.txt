â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸ”§ FIX CRÃTICO: API DEBE ACTUALIZAR rawWooData
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“… Fecha: 29 de diciembre de 2025
ğŸ¯ Problema: Cambios no se reflejan en WooCommerce al editar
âœ… SoluciÃ³n: API debe enviar rawWooData a Strapi

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
1. âŒ EL PROBLEMA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Actualmente el API hace esto al editar un producto:

```typescript
// âŒ CÃ“DIGO ACTUAL (INCORRECTO)
const updateData = {
  data: {
    nombre_libro: body.nombre_libro,
    descripcion: convertirHTMLaBlocks(body.descripcion),
    subtitulo_libro: body.subtitulo_libro,
    precio: body.precio,
    precio_oferta: body.precio_oferta,
    stock_quantity: body.stock_quantity,
    portada_libro: body.portada_libro_id,
    canales: body.canales,
    estado_publicacion: 'Publicado'
  }
  // âŒ NO incluye rawWooData
};

await strapiClient.put(`/api/libros/${documentId}`, updateData);
```

**Resultado:**
- Strapi actualiza descripcion, subtitulo_libro, precio, etc. âœ…
- Pero el campo `rawWooData` en la BD NO se actualiza âŒ
- Cuando Strapi sincroniza con WooCommerce, usa el rawWooData VIEJO
- Los cambios NO se reflejan en WooCommerce âŒ

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2. âœ… LA SOLUCIÃ“N
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

El API DEBE incluir rawWooData en el payload a Strapi:

```typescript
// âœ… CÃ“DIGO CORRECTO
const updateData = {
  data: {
    nombre_libro: body.nombre_libro,
    descripcion: convertirHTMLaBlocks(body.descripcion),
    subtitulo_libro: body.subtitulo_libro,
    precio: body.precio,
    precio_oferta: body.precio_oferta,
    stock_quantity: body.stock_quantity,
    portada_libro: body.portada_libro_id,
    canales: body.canales,
    estado_publicacion: 'Publicado',
    
    // âœ… INCLUIR rawWooData
    rawWooData: body.raw_woo_data || body.rawWooData
  }
};

await strapiClient.put(`/api/libros/${documentId}`, updateData);
```

**Resultado:**
- Strapi actualiza TODOS los campos, incluyendo rawWooData âœ…
- El lifecycle detecta el cambio y sincroniza âœ…
- buildWooProduct() usa el rawWooData actualizado âœ…
- Los cambios SE REFLEJAN en WooCommerce âœ…

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
3. ğŸ” POR QUÃ‰ FUNCIONA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

El campo `rawWooData` existe en el schema de Strapi:

```json
// strapi/src/api/libro/content-types/libro/schema.json
{
  "attributes": {
    "rawWooData": {
      "type": "json",
      "description": "Datos completos del producto en formato WooCommerce"
    }
  }
}
```

**Strapi SÃ acepta este campo** en actualizaciones PUT.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
4. ğŸ“ CÃ“DIGO A CAMBIAR EN EL API
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Archivo: `frontend-ubold/src/app/api/tienda/productos/[id]/route.ts`

### ANTES (lÃ­neas ~150-170):

```typescript
const updateData: any = {
  data: {
    nombre_libro: body.nombre_libro,
    descripcion: convertirHTMLaBlocks(body.descripcion),
    subtitulo_libro: body.subtitulo_libro,
    isbn_libro: body.isbn_libro,
    precio: body.precio,
    precio_oferta: body.precio_oferta,
    stock_quantity: body.stock_quantity,
    portada_libro: portadaLibroId,
    canales: canalesIds,
    estado_publicacion: estadoFinal
  }
};
```

### DESPUÃ‰S:

```typescript
const updateData: any = {
  data: {
    nombre_libro: body.nombre_libro,
    descripcion: convertirHTMLaBlocks(body.descripcion),
    subtitulo_libro: body.subtitulo_libro,
    isbn_libro: body.isbn_libro,
    precio: body.precio,
    precio_oferta: body.precio_oferta,
    stock_quantity: body.stock_quantity,
    portada_libro: portadaLibroId,
    canales: canalesIds,
    estado_publicacion: estadoFinal,
    
    // âœ… AGREGAR ESTA LÃNEA
    rawWooData: body.raw_woo_data || body.rawWooData || null
  }
};
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
5. âš ï¸ NOTA IMPORTANTE: NormalizaciÃ³n de Campos
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

El frontend envÃ­a `rawWooData` (camelCase).
El API normaliza automÃ¡ticamente a `raw_woo_data` (snake_case).

Pero al enviar a Strapi, debe ser `rawWooData` (camelCase):

```typescript
// Frontend envÃ­a:
{
  rawWooData: { ... }  // camelCase
}

// API normaliza internamente:
body.raw_woo_data = body.rawWooData

// API envÃ­a a Strapi:
{
  data: {
    rawWooData: body.raw_woo_data  // âœ… Strapi espera camelCase
  }
}
```

**CÃ³digo correcto:**

```typescript
// DespuÃ©s de la normalizaciÃ³n
const updateData: any = {
  data: {
    // ... otros campos ...
    
    // âœ… Usar snake_case del body normalizado
    rawWooData: body.raw_woo_data || body.rawWooData || null
  }
};
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
6. ğŸ§ª CÃ“MO PROBAR QUE FUNCIONA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

### Prueba 1: Editar descripciÃ³n

1. Editar un producto desde la Intranet
2. Cambiar solo la "DescripciÃ³n del producto"
3. Guardar
4. Verificar en WooCommerce que el cambio aparezca

Esperado: âœ… La descripciÃ³n se actualiza en WooCommerce

### Prueba 2: Editar precio

1. Editar un producto desde la Intranet
2. Cambiar solo el precio
3. Guardar
4. Verificar en WooCommerce que el precio se actualice

Esperado: âœ… El precio se actualiza en WooCommerce

### Prueba 3: Verificar logs de Strapi

DespuÃ©s de editar, revisar logs:

```
[libro] ğŸ”„ [LIBRO - afterUpdate ejecutado]
[libro] Estado de publicaciÃ³n: "Publicado"
[libro] âœ… Estado correcto para sincronizar
[libro] ğŸš€ Llamando a syncToWooCommerce()...
[woo-sync] âœ… Usando rawWooData desde Intranet
[woo-sync] ğŸ“¦ rawWooData: { description: "...", short_description: "...", ... }
[libro] âœ… SincronizaciÃ³n completada exitosamente
```

Si ves "âœ… Usando rawWooData desde Intranet" â†’ Â¡Funciona!

Si ves "ğŸ”§ Construyendo producto de forma tradicional" â†’ rawWooData NO llegÃ³

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
7. ğŸ¯ RESUMEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

**Cambio necesario:**
- Agregar UNA LÃNEA en el API route: `rawWooData: body.raw_woo_data || null`

**DÃ³nde:**
- `frontend-ubold/src/app/api/tienda/productos/[id]/route.ts`
- Dentro de `updateData.data`

**Por quÃ©:**
- Sin esto, Strapi usa rawWooData viejo o lo reconstruye
- Con esto, Strapi usa el rawWooData actualizado del frontend
- Resultado: Cambios se reflejan en WooCommerce

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
8. ğŸ“‹ CHECKLIST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–¡ 1. Abrir `frontend-ubold/src/app/api/tienda/productos/[id]/route.ts`
â–¡ 2. Buscar `const updateData: any = { data: { ... } }`
â–¡ 3. Agregar lÃ­nea: `rawWooData: body.raw_woo_data || body.rawWooData || null`
â–¡ 4. Guardar archivo
â–¡ 5. Reiniciar servidor frontend (si es necesario)
â–¡ 6. Probar editando un producto
â–¡ 7. Verificar que cambios aparezcan en WooCommerce
â–¡ 8. Revisar logs de Strapi para confirmar

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… FIN DEL DOCUMENTO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

