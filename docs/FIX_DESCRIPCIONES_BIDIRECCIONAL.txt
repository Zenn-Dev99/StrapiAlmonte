â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”§ FIX COMPLETO: Descripciones Bidireccionales
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PROBLEMA IDENTIFICADO:
âŒ Descripciones NO se sincronizan Intranet â†’ WooCommerce
âŒ Descripciones NO se sincronizan WooCommerce â†’ Intranet

CAUSA:
- Campo incorrecto en Strapi (usaba subtitulo_libro)
- Falta rawWooData con description y short_description en formato HTML

SOLUCIÃ“N IMPLEMENTADA EN STRAPI:
âœ… Strapi ahora lee descripcion (campo blocks) y lo convierte a texto
âœ… Strapi ahora guarda description de WooCommerce en descripcion (blocks)
âœ… Strapi ahora guarda short_description en subtitulo_libro

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SOLUCIÃ“N PARA LA INTRANET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

DEBES ENVIAR DESCRIPCIONES EN rawWooData EN FORMATO HTML

PAYLOAD CORRECTO:

{
  data: {
    nombre_libro: "CÃ¡lculo I - 10Âª EdiciÃ³n",
    isbn_libro: "9788491820123",
    precio: 49990,
    stock_quantity: 100,
    estado_publicacion: "Publicado",
    canales: [1, 2],
    
    // âœ… CAMPO OPCIONAL: descripcion en formato blocks (para Strapi)
    descripcion: [
      {
        type: "paragraph",
        children: [
          {
            type: "text",
            text: "DescripciÃ³n completa del producto en texto plano"
          }
        ]
      }
    ],
    
    // âœ… CAMPO OPCIONAL: subtitulo_libro (descripciÃ³n corta en Strapi)
    subtitulo_libro: "Resumen breve del producto",
    
    // âœ… CRÃTICO: rawWooData con descripciones en HTML
    rawWooData: {
      name: "CÃ¡lculo I - 10Âª EdiciÃ³n",
      type: "simple",
      status: "publish",
      
      // âœ… DESCRIPCIÃ“N COMPLETA EN HTML
      description: "<p>DescripciÃ³n completa del producto con formato HTML.</p><p>Puede incluir mÃºltiples pÃ¡rrafos.</p>",
      
      // âœ… DESCRIPCIÃ“N CORTA EN HTML (mÃ¡ximo 150-200 caracteres)
      short_description: "<p>Resumen breve del producto en HTML.</p>",
      
      regular_price: "49990.00",
      manage_stock: true,
      stock_quantity: 100,
      stock_status: "instock",
      backorders: "no"
    }
  }
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
IMPORTANTE: FORMATO DE DESCRIPCIONES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. DESCRIPCIÃ“N COMPLETA (description)
   âœ… Debe estar en formato HTML
   âœ… Usar etiquetas <p>, <h3>, <ul>, <li>, <strong>, <em>, etc.
   âœ… Sin lÃ­mite de caracteres
   
   EJEMPLOS:
   
   BÃ¡sico:
   description: "<p>DescripciÃ³n del producto</p>"
   
   Con formato:
   description: `
     <p>CÃ¡lculo I es un libro fundamental para estudiantes de ingenierÃ­a.</p>
     <h3>CaracterÃ­sticas:</h3>
     <ul>
       <li>10Âª EdiciÃ³n actualizada</li>
       <li>MÃ¡s de 500 ejercicios resueltos</li>
       <li>Soluciones paso a paso</li>
     </ul>
     <h3>Contenido:</h3>
     <p>El libro cubre los temas fundamentales del cÃ¡lculo diferencial e integral.</p>
   `

2. DESCRIPCIÃ“N CORTA (short_description)
   âœ… Debe estar en formato HTML
   âœ… MÃ¡ximo 150-200 caracteres
   âœ… Usar etiqueta <p> al menos
   âœ… Aparece en listados de productos
   
   EJEMPLOS:
   
   short_description: "<p>Libro de CÃ¡lculo I para ingenierÃ­a. 10Âª EdiciÃ³n con 500+ ejercicios.</p>"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FUNCIÃ“N HELPER: CONVERTIR TEXTO A HTML
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Si tienes texto plano y necesitas convertirlo a HTML:

// FunciÃ³n para convertir texto plano a HTML
function textoAHTML(texto) {
  if (!texto) return '';
  
  // Convertir saltos de lÃ­nea dobles en pÃ¡rrafos
  const parrafos = texto.split('\n\n')
    .filter(p => p.trim())
    .map(p => `<p>${p.trim()}</p>`)
    .join('');
  
  return parrafos || `<p>${texto}</p>`;
}

// FunciÃ³n para generar descripciÃ³n corta
function generarDescripcionCorta(texto, maxCaracteres = 150) {
  if (!texto) return '';
  
  const textoLimpio = texto.replace(/\n/g, ' ').trim();
  const textoCorto = textoLimpio.length > maxCaracteres
    ? textoLimpio.substring(0, maxCaracteres) + '...'
    : textoLimpio;
  
  return `<p>${textoCorto}</p>`;
}

// Uso:
const descripcionHTML = textoAHTML(formData.descripcion);
const descripcionCortaHTML = generarDescripcionCorta(formData.descripcion, 150);

rawWooData: {
  description: descripcionHTML,
  short_description: descripcionCortaHTML
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
IMPLEMENTACIÃ“N EN EL FORMULARIO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

En tu componente de crear/editar producto:

const handleSubmit = async (formData) => {
  // 1. Convertir texto plano a HTML
  const descripcionHTML = formData.descripcion
    ? textoAHTML(formData.descripcion)
    : '';
  
  const descripcionCortaHTML = formData.descripcion
    ? generarDescripcionCorta(formData.descripcion, 150)
    : '';
  
  // 2. Convertir texto plano a formato blocks (opcional)
  const descripcionBlocks = formData.descripcion
    ? [
        {
          type: 'paragraph',
          children: [
            { type: 'text', text: formData.descripcion }
          ]
        }
      ]
    : null;
  
  // 3. Construir payload
  const payload = {
    data: {
      nombre_libro: formData.nombre,
      isbn_libro: formData.isbn,
      precio: parseFloat(formData.precio),
      stock_quantity: parseInt(formData.stock) || 0,
      estado_publicacion: "Publicado",
      canales: [1, 2],
      
      // âœ… Opcional: descripcion en formato blocks
      ...(descripcionBlocks && { descripcion: descripcionBlocks }),
      
      // âœ… Opcional: subtitulo_libro como descripciÃ³n corta
      ...(formData.descripcion && { 
        subtitulo_libro: formData.descripcion.substring(0, 255) 
      }),
      
      // âœ… CRÃTICO: rawWooData con HTML
      rawWooData: {
        name: formData.nombre,
        type: "simple",
        status: "publish",
        
        // âœ… Descripciones en HTML
        description: descripcionHTML,
        short_description: descripcionCortaHTML,
        
        regular_price: formData.precio.toString(),
        manage_stock: true,
        stock_quantity: parseInt(formData.stock) || 0,
        stock_status: parseInt(formData.stock) > 0 ? 'instock' : 'outofstock',
        backorders: 'no',
        
        // Otros campos...
      }
    }
  };
  
  // 4. Enviar a Strapi
  const response = await fetch(
    modoEdicion 
      ? `https://strapi.moraleja.cl/api/libros/${productoId}`
      : 'https://strapi.moraleja.cl/api/libros',
    {
      method: modoEdicion ? 'PUT' : 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    }
  );
  
  if (response.ok) {
    console.log('âœ… Producto guardado con descripciones');
  }
};

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CARGAR DESCRIPCIONES AL EDITAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Al obtener un producto para editar, necesitas extraer el texto de blocks:

const cargarProducto = async (productoId) => {
  const response = await fetch(
    `https://strapi.moraleja.cl/api/libros/${productoId}?populate=*`
  );
  const data = await response.json();
  const producto = data.data.attributes;
  
  // Convertir descripcion (blocks) a texto plano
  let descripcionTexto = '';
  if (producto.descripcion && Array.isArray(producto.descripcion)) {
    descripcionTexto = producto.descripcion
      .map(block => {
        if (block.children && Array.isArray(block.children)) {
          return block.children.map(child => child.text || '').join('');
        }
        return '';
      })
      .join('\n\n');
  }
  
  // Llenar formulario
  setFormData({
    nombre: producto.nombre_libro,
    isbn: producto.isbn_libro,
    precio: producto.precio,
    stock: producto.stock_quantity,
    descripcion: descripcionTexto || producto.subtitulo_libro || '',
    // ...otros campos
  });
};

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
VALIDACIONES RECOMENDADAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Antes de enviar, valida:

function validarDescripciones(formData) {
  const errores = {};
  
  // DescripciÃ³n mÃ­nima
  if (!formData.descripcion || formData.descripcion.length < 10) {
    errores.descripcion = 'La descripciÃ³n debe tener al menos 10 caracteres';
  }
  
  // DescripciÃ³n mÃ¡xima razonable
  if (formData.descripcion && formData.descripcion.length > 5000) {
    errores.descripcion = 'La descripciÃ³n es demasiado larga (mÃ¡ximo 5000 caracteres)';
  }
  
  return errores;
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
VERIFICAR QUE FUNCIONA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. CREAR PRODUCTO DESDE INTRANET
   âœ… Enviar con rawWooData.description en HTML
   âœ… Verificar en WooCommerce Admin que aparece la descripciÃ³n
   âœ… Verificar en el frontend que se muestra correctamente

2. EDITAR PRODUCTO EN WOOCOMMERCE
   âœ… Cambiar description y short_description en WooCommerce Admin
   âœ… Webhook sincroniza a Strapi
   âœ… Verificar en Strapi que descripcion (blocks) se actualizÃ³
   âœ… Abrir producto en Intranet y ver que cargÃ³ la nueva descripciÃ³n

3. EDITAR PRODUCTO DESDE INTRANET
   âœ… Cambiar descripciÃ³n en formulario
   âœ… Guardar cambios
   âœ… Verificar en WooCommerce que se actualizÃ³

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EJEMPLO COMPLETO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Helper functions (agregar al inicio del archivo)
function textoAHTML(texto) {
  if (!texto) return '';
  const parrafos = texto.split('\n\n')
    .filter(p => p.trim())
    .map(p => `<p>${p.trim()}</p>`)
    .join('');
  return parrafos || `<p>${texto}</p>`;
}

function generarDescripcionCorta(texto, max = 150) {
  if (!texto) return '';
  const limpio = texto.replace(/\n/g, ' ').trim();
  const corto = limpio.length > max ? limpio.substring(0, max) + '...' : limpio;
  return `<p>${corto}</p>`;
}

// En el componente
const FormularioProducto = () => {
  const [formData, setFormData] = useState({
    nombre: '',
    isbn: '',
    precio: '',
    stock: 0,
    descripcion: '', // âœ… Campo de texto para descripciÃ³n
  });
  
  const handleSubmit = async (e) => {
    e.preventDefault();
    
    const payload = {
      data: {
        nombre_libro: formData.nombre,
        isbn_libro: formData.isbn,
        precio: parseFloat(formData.precio),
        stock_quantity: parseInt(formData.stock) || 0,
        estado_publicacion: "Publicado",
        canales: [1, 2],
        
        // Opcional: formato blocks
        descripcion: formData.descripcion ? [
          {
            type: 'paragraph',
            children: [{ type: 'text', text: formData.descripcion }]
          }
        ] : null,
        
        rawWooData: {
          name: formData.nombre,
          
          // âœ… Descripciones en HTML
          description: textoAHTML(formData.descripcion),
          short_description: generarDescripcionCorta(formData.descripcion),
          
          regular_price: formData.precio.toString(),
          manage_stock: true,
          stock_quantity: parseInt(formData.stock) || 0,
          stock_status: parseInt(formData.stock) > 0 ? 'instock' : 'outofstock'
        }
      }
    };
    
    const response = await fetch('https://strapi.moraleja.cl/api/libros', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    
    if (response.ok) {
      console.log('âœ… Producto creado con descripciones');
    }
  };
  
  return (
    <form onSubmit={handleSubmit}>
      <input
        type="text"
        value={formData.nombre}
        onChange={(e) => setFormData({...formData, nombre: e.target.value})}
        placeholder="Nombre del producto"
      />
      
      <textarea
        value={formData.descripcion}
        onChange={(e) => setFormData({...formData, descripcion: e.target.value})}
        placeholder="DescripciÃ³n completa del producto"
        rows={10}
      />
      
      <button type="submit">Crear Producto</button>
    </form>
  );
};

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RESUMEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… STRAPI YA ESTÃ CORREGIDO
   - Lee descripcion (blocks) y lo convierte a texto para WooCommerce
   - Guarda description de WooCommerce en descripcion (blocks)
   - SincronizaciÃ³n bidireccional funcionando

âœ… INTRANET DEBE:
   1. Enviar rawWooData.description en formato HTML
   2. Enviar rawWooData.short_description en formato HTML
   3. Usar funciones helper para convertir texto a HTML
   4. Al editar, convertir blocks a texto plano para mostrar

âœ… FLUJO COMPLETO:
   Intranet â†’ rawWooData con HTML â†’ Strapi â†’ WooCommerce âœ…
   WooCommerce â†’ Webhook â†’ Strapi blocks â†’ Intranet texto âœ…

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

IMPLEMENTA ESTAS FUNCIONES HELPER Y ACTUALIZA EL FORMULARIO
PARA QUE LAS DESCRIPCIONES SE SINCRONICEN CORRECTAMENTE.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

